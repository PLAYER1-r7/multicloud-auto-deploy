# AI エージェント ドキュメント作成ガイド

## 概要

このガイドは、AI エージェント (GitHub Copilot) がドキュメントや長いファイルを作成・編集する際の注意事項をまとめたものです。

---

## 注意: 大きなレスポンス生成時のネットワークエラー

### 症状

AI エージェントが一度に長い内容を生成しようとすると、生成途中でネットワークエラーが発生し、**レスポンスが途中で切れる**ことがある。

具体的には：
- `create_file` で一度に数百行のファイルを作成しようとしたとき
- `replace_string_in_file` で `newString` に大量のテキストを含めたとき

### 対策: セクション単位で分割して書く

一度の操作で書く量を制限し、**セクションごとに分けて追記**する。

#### 推奨フロー

```
1. create_file でスケルトン（タイトル、目次のみ）を作成
2. 最初のセクションを replace_string_in_file または append で追記
3. ファイルの末尾を確認（tail コマンドや read_file）
4. 次のセクションを追記
5. 3-4 を繰り返す
```

#### ファイル末尾への追記方法

Python を使うと特殊文字（バッククォートなど）の影響を受けずに安全に追記できる：

```bash
python3 - << 'PYEOF'
content = """
## セクション名

内容...
"""
with open('/path/to/file.md', 'a') as f:
    f.write(content)
print("done")
PYEOF
```

> **注意**: `heredoc` (`cat << EOF`) は `$変数` や バッククォートが展開されるため、Markdown のコードブロック（バッククォート3つ）を含む内容を書く場合は上記 Python 方式を使う。`SECTION_EOF` のように引用符で囲んだデリミタにすれば変数展開を防げる。

#### replace_string_in_file の注意点

- `oldString` は**完全一致**が必要。末尾の空白・改行の差異でマッチに失敗する
- マッチ失敗時は `tail -5 file | cat -A` で末尾の正確な内容（`$` = 行末、`^I` = タブ）を確認する
- 複数箇所にマッチする可能性がある場合は前後のコンテキスト（3行以上）を必ず含める

---

## ドキュメント追記の基本手順

```
1. ファイルの現在の末尾を確認
   → tail -3 /path/to/file.md

2. Python で追記
   → python3 append_section.py

3. 行数確認で追記成功を検証
   → wc -l /path/to/file.md

4. 次のセクションへ進む
```

---

## 関連ドキュメント

- [AI_AGENT_GUIDE.md](AI_AGENT_GUIDE.md) — AI エージェント全般ガイド
- [SNS_FIX_REPORT_20260222.md](SNS_FIX_REPORT_20260222.md) — このガイドの実践例（分割追記で作成）
